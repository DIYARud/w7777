<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shaxsiy Hisoblagich - Takomillashtirilgan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6C63FF;
            --secondary: #4A47B1;
            --income: #36D1DC;
            --expense: #FF6B6B;
            --light: #F8F9FA;
            --dark: #2D3748;
            --success: #4CAF50;
            --warning: #FF9800;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }
        
        .dark-theme {
            --light: #1A202C;
            --dark: #F7FAFC;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
            line-height: 1.6;
            transition: var(--transition);
            min-height: 100vh;
        }
        
        body.dark-theme {
            background: linear-gradient(135deg, #2D3748 0%, #4A5568 100%);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: var(--shadow);
            animation: slideDown 0.5s ease;
            backdrop-filter: blur(10px);
        }
        
        body.dark-theme header {
            background: rgba(45, 55, 72, 0.9);
        }
        
        .theme-toggle {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }
        
        .theme-toggle:hover {
            transform: rotate(30deg);
            background: var(--secondary);
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .balance-container {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            text-align: center;
            animation: fadeIn 0.8s ease;
            backdrop-filter: blur(10px);
        }
        
        body.dark-theme .balance-container {
            background: rgba(45, 55, 72, 0.9);
        }
        
        .balance {
            font-size: 3rem;
            font-weight: bold;
            margin: 15px 0;
            transition: var(--transition);
        }
        
        .positive {
            color: var(--income);
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .negative {
            color: var(--expense);
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-item {
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
            animation: fadeIn 0.8s ease 0.2s both;
            backdrop-filter: blur(10px);
        }
        
        body.dark-theme .summary-item {
            background: rgba(45, 55, 72, 0.9);
        }
        
        .summary-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .income {
            border-top: 5px solid var(--income);
        }
        
        .expense {
            border-top: 5px solid var(--expense);
        }
        
        .summary-amount {
            font-size: 1.8rem;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .transaction-form, .analytics {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease 0.4s both;
            backdrop-filter: blur(10px);
        }
        
        body.dark-theme .transaction-form, 
        body.dark-theme .analytics {
            background: rgba(45, 55, 72, 0.9);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        body.dark-theme input, 
        body.dark-theme select {
            background: #2D3748;
            border-color: #4A5568;
            color: var(--dark);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }
        
        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .transaction-list {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease 0.6s both;
            backdrop-filter: blur(10px);
        }
        
        body.dark-theme .transaction-list {
            background: rgba(45, 55, 72, 0.9);
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
            animation: slideIn 0.5s ease;
        }
        
        body.dark-theme .transaction-item {
            border-bottom-color: #4A5568;
        }
        
        .transaction-item:hover {
            background: rgba(108, 99, 255, 0.05);
            border-radius: 10px;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-details {
            flex: 2;
            display: flex;
            flex-direction: column;
        }
        
        .transaction-category {
            font-size: 0.8rem;
            color: #777;
            margin-top: 5px;
        }
        
        body.dark-theme .transaction-category {
            color: #CBD5E0;
        }
        
        .transaction-amount {
            flex: 1;
            text-align: right;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .income-amount {
            color: var(--income);
        }
        
        .expense-amount {
            color: var(--expense);
        }
        
        .delete-btn {
            background: var(--expense);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
            margin-left: 15px;
            transition: var(--transition);
        }
        
        .delete-btn:hover {
            background: #d32f2f;
            transform: scale(1.05);
        }
        
        .no-transactions {
            text-align: center;
            padding: 30px;
            color: #777;
            font-style: italic;
        }
        
        body.dark-theme .no-transactions {
            color: #CBD5E0;
        }
        
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }
        
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 15px;
            background: #E2E8F0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        body.dark-theme .filter-btn {
            background: #4A5568;
            color: #F7FAFC;
        }
        
        .filter-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.7);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        body.dark-theme .stat-item {
            background: rgba(45, 55, 72, 0.7);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 5px;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--success);
            color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            transform: translateX(150%);
            transition: transform 0.5s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .export-btn {
            background: var(--success);
            margin-top: 15px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #E2E8F0;
        }
        
        body.dark-theme .tabs {
            border-bottom-color: #4A5568;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1><i class="fas fa-wallet"></i> Shaxsiy Hisoblagich</h1>
                <p>Daromad va xarajatlaringizni boshqarish</p>
            </div>
            <button class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
            </button>
        </header>
        
        <div class="balance-container">
            <h2>Joriy Balans</h2>
            <div class="balance positive" id="balance">0 so'm</div>
            <p>Oxirgi yangilanish: <span id="last-update">-</span></p>
        </div>
        
        <div class="summary">
            <div class="summary-item income">
                <h3><i class="fas fa-arrow-down"></i> Daromad</h3>
                <div class="summary-amount" id="income-total">0 so'm</div>
                <p>Oxirgi 30 kun</p>
            </div>
            <div class="summary-item expense">
                <h3><i class="fas fa-arrow-up"></i> Xarajat</h3>
                <div class="summary-amount" id="expense-total">0 so'm</div>
                <p>Oxirgi 30 kun</p>
            </div>
            <div class="summary-item">
                <h3><i class="fas fa-piggy-bank"></i> Jamg'arish</h3>
                <div class="summary-amount" id="savings-rate">0%</div>
                <p>Daromadning xarajatga nisbati</p>
            </div>
            <div class="summary-item">
                <h3><i class="fas fa-chart-line"></i> O'rtacha kunlik</h3>
                <div class="summary-amount" id="daily-average">0 so'm</div>
                <p>Xarajatlar</p>
            </div>
        </div>
        
        <div class="dashboard">
            <div class="transaction-form">
                <h3><i class="fas fa-plus-circle"></i> Yangi operatsiya qo'shish</h3>
                <form id="transaction-form">
                    <div class="form-group">
                        <label for="description">Tavsif</label>
                        <input type="text" id="description" placeholder="Masalan: Oylik maosh" required>
                    </div>
                    <div class="form-group">
                        <label for="amount">Miqdor (so'm)</label>
                        <input type="number" id="amount" placeholder="Masalan: 1000000" required>
                    </div>
                    <div class="form-group">
                        <label for="category">Kategoriya</label>
                        <select id="category" required>
                            <option value="ish">Ish</option>
                            <option value="savdo">Savdo</option>
                            <option value="investitsiya">Investitsiya</option>
                            <option value="oqibat">Oqibat</option>
                            <option value="ovqat">Ovqat</option>
                            <option value="transport">Transport</option>
                            <option value="kommunal">Kommunal</option>
                            <option value="sog'liq">Sog'liq</option>
                            <option value="ta'lim">Ta'lim</option>
                            <option value="ko'ngilochar">Ko'ngilochar</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="type">Turi</label>
                        <select id="type" required>
                            <option value="income">Daromad</option>
                            <option value="expense">Xarajat</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="date">Sana</label>
                        <input type="date" id="date" required>
                    </div>
                    <button type="submit" class="btn"><i class="fas fa-plus"></i> Qo'shish</button>
                </form>
                <button class="btn export-btn" id="export-btn"><i class="fas fa-file-export"></i> Ma'lumotlarni eksport qilish</button>
            </div>
            
            <div class="analytics">
                <h3><i class="fas fa-chart-pie"></i> Tahlillar</h3>
                <div class="tabs">
                    <div class="tab active" data-tab="chart">Xarita</div>
                    <div class="tab" data-tab="stats">Statistika</div>
                </div>
                
                <div class="tab-content" id="chart-tab">
                    <div class="chart-container">
                        <canvas id="analytics-chart"></canvas>
                    </div>
                </div>
                
                <div class="tab-content" id="stats-tab" style="display: none;">
                    <div class="filters">
                        <button class="filter-btn active" data-filter="all">Hammasi</button>
                        <button class="filter-btn" data-filter="week">Oxirgi hafta</button>
                        <button class="filter-btn" data-filter="month">Oxirgi oy</button>
                        <button class="filter-btn" data-filter="year">Oxirgi yil</button>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div>Eng katta daromad</div>
                            <div class="stat-value" id="max-income">0</div>
                        </div>
                        <div class="stat-item">
                            <div>Eng katta xarajat</div>
                            <div class="stat-value" id="max-expense">0</div>
                        </div>
                        <div class="stat-item">
                            <div>Daromadlar soni</div>
                            <div class="stat-value" id="income-count">0</div>
                        </div>
                        <div class="stat-item">
                            <div>Xarajatlar soni</div>
                            <div class="stat-value" id="expense-count">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="transaction-list">
            <h3><i class="fas fa-history"></i> Operatsiyalar tarixi</h3>
            <div class="filters">
                <button class="filter-btn active" data-type="all">Hammasi</button>
                <button class="filter-btn" data-type="income">Daromad</button>
                <button class="filter-btn" data-type="expense">Xarajat</button>
            </div>
            <div id="transaction-history">
                <div class="no-transactions">Hozircha operatsiyalar mavjud emas</div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        Operatsiya muvaffaqiyatli qo'shildi!
    </div>

    <script>
        // DOM elementlari
        const transactionForm = document.getElementById('transaction-form');
        const descriptionInput = document.getElementById('description');
        const amountInput = document.getElementById('amount');
        const categoryInput = document.getElementById('category');
        const typeInput = document.getElementById('type');
        const dateInput = document.getElementById('date');
        const balanceElement = document.getElementById('balance');
        const incomeTotalElement = document.getElementById('income-total');
        const expenseTotalElement = document.getElementById('expense-total');
        const transactionHistoryElement = document.getElementById('transaction-history');
        const themeToggle = document.getElementById('theme-toggle');
        const exportBtn = document.getElementById('export-btn');
        const notification = document.getElementById('notification');
        const lastUpdateElement = document.getElementById('last-update');
        const savingsRateElement = document.getElementById('savings-rate');
        const dailyAverageElement = document.getElementById('daily-average');
        const maxIncomeElement = document.getElementById('max-income');
        const maxExpenseElement = document.getElementById('max-expense');
        const incomeCountElement = document.getElementById('income-count');
        const expenseCountElement = document.getElementById('expense-count');
        
        // Analytics chart
        let analyticsChart = null;

        // Joriy sanani o'rnatish
        dateInput.valueAsDate = new Date();

        // Local Storage'dan ma'lumotlarni olish
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

        // Dasturni ishga tushirish
        function init() {
            updateUI();
            
            // Formani qayta ishlash
            transactionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const description = descriptionInput.value.trim();
                const amount = parseFloat(amountInput.value);
                const category = categoryInput.value;
                const type = typeInput.value;
                const date = dateInput.value;
                
                if (description === '' || isNaN(amount) || amount <= 0) {
                    showNotification('Iltimos, barcha maydonlarni to\'g\'ri to\'ldiring!', 'error');
                    return;
                }
                
                addTransaction(description, amount, category, type, date);
                
                // Formani tozalash
                descriptionInput.value = '';
                amountInput.value = '';
                categoryInput.value = 'ish';
                typeInput.value = 'income';
                dateInput.valueAsDate = new Date();
                
                showNotification('Operatsiya muvaffaqiyatli qo\'shildi!', 'success');
            });
            
            // Tema o'zgartirish
            themeToggle.addEventListener('click', toggleTheme);
            
            // Eksport qilish
            exportBtn.addEventListener('click', exportData);
            
            // Filter tugmalari
            document.querySelectorAll('.filter-btn[data-type]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn[data-type]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    filterTransactions(this.getAttribute('data-type'));
                });
            });
            
            // Analytics filter tugmalari
            document.querySelectorAll('.filter-btn[data-filter]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn[data-filter]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateAnalytics(this.getAttribute('data-filter'));
                });
            });
            
            // Tablar
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Barcha tab kontentlarini yashirish
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    // Barcha tablarni inaktiv qilish
                    document.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // Tanlangan tabni ko'rsatish
                    document.getElementById(`${tabId}-tab`).style.display = 'block';
                    this.classList.add('active');
                });
            });
        }

        // Yangi operatsiya qo'shish
        function addTransaction(description, amount, category, type, date) {
            const transaction = {
                id: Date.now(),
                description,
                amount,
                category,
                type,
                date
            };
            
            transactions.push(transaction);
            saveTransactions();
            updateUI();
        }

        // Operatsiyani o'chirish
        function deleteTransaction(id) {
            transactions = transactions.filter(transaction => transaction.id !== id);
            saveTransactions();
            updateUI();
            showNotification('Operatsiya o\'chirildi!', 'warning');
        }

        // Ma'lumotlarni local storage'ga saqlash
        function saveTransactions() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
            lastUpdateElement.textContent = new Date().toLocaleString('uz-UZ');
        }

        // UI ni yangilash
        function updateUI() {
            // Balansni hisoblash
            const income = transactions
                .filter(transaction => transaction.type === 'income')
                .reduce((total, transaction) => total + transaction.amount, 0);
                
            const expense = transactions
                .filter(transaction => transaction.type === 'expense')
                .reduce((total, transaction) => total + transaction.amount, 0);
                
            const balance = income - expense;
            
            // Balansni ko'rsatish
            balanceElement.textContent = `${formatCurrency(balance)} so'm`;
            balanceElement.className = `balance ${balance >= 0 ? 'positive' : 'negative'}`;
            
            // Animatsiya qo'shish
            if (balance >= 0) {
                balanceElement.classList.add('pulse');
            } else {
                balanceElement.classList.remove('pulse');
            }
            
            // Daromad va xarajatlarni ko'rsatish
            incomeTotalElement.textContent = `${formatCurrency(income)} so'm`;
            expenseTotalElement.textContent = `${formatCurrency(expense)} so'm`;
            
            // Qo'shimcha statistikalar
            updateStatistics();
            
            // Operatsiyalar tarixini ko'rsatish
            renderTransactionHistory();
            
            // Tahlillarni yangilash
            updateAnalytics('all');
            
            // Yangilangan vaqtni ko'rsatish
            lastUpdateElement.textContent = new Date().toLocaleString('uz-UZ');
        }

        // Qo'shimcha statistikalar
        function updateStatistics() {
            const income = transactions
                .filter(transaction => transaction.type === 'income')
                .reduce((total, transaction) => total + transaction.amount, 0);
                
            const expense = transactions
                .filter(transaction => transaction.type === 'expense')
                .reduce((total, transaction) => total + transaction.amount, 0);
            
            // Jamg'arish darajasi
            const savingsRate = income > 0 ? ((income - expense) / income * 100).toFixed(1) : 0;
            savingsRateElement.textContent = `${savingsRate}%`;
            
            // O'rtacha kunlik xarajat
            const expenseTransactions = transactions.filter(t => t.type === 'expense');
            const totalExpense = expenseTransactions.reduce((sum, t) => sum + t.amount, 0);
            const dailyAverage = expenseTransactions.length > 0 ? totalExpense / 30 : 0;
            dailyAverageElement.textContent = `${formatCurrency(dailyAverage)} so'm`;
            
            // Eng katta daromad va xarajat
            const incomes = transactions.filter(t => t.type === 'income').map(t => t.amount);
            const expenses = transactions.filter(t => t.type === 'expense').map(t => t.amount);
            
            const maxIncome = incomes.length > 0 ? Math.max(...incomes) : 0;
            const maxExpense = expenses.length > 0 ? Math.max(...expenses) : 0;
            
            maxIncomeElement.textContent = `${formatCurrency(maxIncome)}`;
            maxExpenseElement.textContent = `${formatCurrency(maxExpense)}`;
            
            // Daromad va xarajatlar soni
            incomeCountElement.textContent = incomes.length;
            expenseCountElement.textContent = expenses.length;
        }

        // Operatsiyalar tarixini chizish
        function renderTransactionHistory(filterType = 'all') {
            let filteredTransactions = transactions;
            
            if (filterType !== 'all') {
                filteredTransactions = transactions.filter(transaction => transaction.type === filterType);
            }
            
            if (filteredTransactions.length === 0) {
                transactionHistoryElement.innerHTML = '<div class="no-transactions">Hozircha operatsiyalar mavjud emas</div>';
                return;
            }
            
            transactionHistoryElement.innerHTML = '';
            
            // Operatsiyalarni teskari tartibda (eng yangisi birinchi) ko'rsatish
            filteredTransactions.slice().reverse().forEach(transaction => {
                const transactionElement = document.createElement('div');
                transactionElement.className = 'transaction-item';
                
                const amountClass = transaction.type === 'income' ? 'income-amount' : 'expense-amount';
                const amountSign = transaction.type === 'income' ? '+' : '-';
                const icon = transaction.type === 'income' ? 'arrow-down' : 'arrow-up';
                
                transactionElement.innerHTML = `
                    <div class="transaction-details">
                        <div><i class="fas fa-${icon}"></i> ${transaction.description}</div>
                        <div class="transaction-category">${formatCategory(transaction.category)} • ${formatDate(transaction.date)}</div>
                    </div>
                    <div class="transaction-amount ${amountClass}">
                        ${amountSign} ${formatCurrency(transaction.amount)} so'm
                        <button class="delete-btn" data-id="${transaction.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                transactionHistoryElement.appendChild(transactionElement);
            });
            
            // O'chirish tugmalariga event listener qo'shish
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteTransaction(id);
                });
            });
        }

        // Operatsiyalarni filtrlash
        function filterTransactions(type) {
            renderTransactionHistory(type);
        }

        // Tahlillarni yangilash
        function updateAnalytics(filter) {
            // Sana bo'yicha filtrlash
            let filteredTransactions = [...transactions];
            const now = new Date();
            
            if (filter === 'week') {
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                filteredTransactions = transactions.filter(t => new Date(t.date) >= weekAgo);
            } else if (filter === 'month') {
                const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                filteredTransactions = transactions.filter(t => new Date(t.date) >= monthAgo);
            } else if (filter === 'year') {
                const yearAgo = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
                filteredTransactions = transactions.filter(t => new Date(t.date) >= yearAgo);
            }
            
            // Kategoriya bo'yicha guruhlash
            const incomeByCategory = {};
            const expenseByCategory = {};
            
            filteredTransactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    incomeByCategory[transaction.category] = (incomeByCategory[transaction.category] || 0) + transaction.amount;
                } else {
                    expenseByCategory[transaction.category] = (expenseByCategory[transaction.category] || 0) + transaction.amount;
                }
            });
            
            // Chart yaratish/yangilash
            const ctx = document.getElementById('analytics-chart').getContext('2d');
            
            if (analyticsChart) {
                analyticsChart.destroy();
            }
            
            analyticsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [...Object.keys(incomeByCategory), ...Object.keys(expenseByCategory)],
                    datasets: [{
                        data: [...Object.values(incomeByCategory), ...Object.values(expenseByCategory)],
                        backgroundColor: [
                            '#36D1DC', '#4CAF50', '#2196F3', '#9C27B0', 
                            '#FF9800', '#F44336', '#795548', '#607D8B',
                            '#8BC34A', '#E91E63'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        title: {
                            display: true,
                            text: 'Daromad va xarajatlar tarkibi'
                        }
                    }
                }
            });
        }

        // Tema o'zgartirish
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const icon = themeToggle.querySelector('i');
            
            if (document.body.classList.contains('dark-theme')) {
                icon.className = 'fas fa-sun';
                showNotification('Qorongʻu mavzusiga oʻzgartirildi', 'success');
            } else {
                icon.className = 'fas fa-moon';
                showNotification('Yorugʻ mavzusiga oʻzgartirildi', 'success');
            }
        }

        // Ma'lumotlarni eksport qilish
        function exportData() {
            const dataStr = JSON.stringify(transactions, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `hisoblagich_ma'lumotlari_${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            
            showNotification('Ma\'lumotlar eksport qilindi!', 'success');
        }

        // Xabarnoma ko'rsatish
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = 'notification';
            
            if (type === 'error') {
                notification.style.background = 'var(--expense)';
            } else if (type === 'warning') {
                notification.style.background = 'var(--warning)';
            } else {
                notification.style.background = 'var(--success)';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Pul miqdorini formatlash
        function formatCurrency(amount) {
            return amount.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        }

        // Kategoriyani formatlash
        function formatCategory(category) {
            const categories = {
                'ish': 'Ish',
                'savdo': 'Savdo',
                'investitsiya': 'Investitsiya',
                'oqibat': 'Oqibat',
                'ovqat': 'Ovqat',
                'transport': 'Transport',
                'kommunal': 'Kommunal',
                'sog\'liq': 'Sog\'liq',
                'ta\'lim': 'Ta\'lim',
                'ko\'ngilochar': 'Ko\'ngilochar'
            };
            
            return categories[category] || category;
        }

        // Sanani formatlash
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('uz-UZ');
        }

        // Dasturni ishga tushirish
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
